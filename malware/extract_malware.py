import os
import subprocess
import datetime

malware_dir = os.path.abspath("./malware_pcap")

saved_dir = os.path.abspath("./malware_filtered")
if not os.path.exists(saved_dir):
    os.mkdir(saved_dir)

# SNIFFER
# Declaring variables for the sniffer
# Capture filter ip_list[0] is taken as the first IP resolved to capture
# Might not be too perfect in the case
count = 0
for filename in os.listdir(malware_dir):
    pcap_file = os.path.abspath(os.path.join(malware_dir, filename))
    display_filter = "tcp.port==443"
    filename = saved_dir + "\\" + "malware" + str(count) + "_" + datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S") + ".pcap"
    command = ["tshark", "-r", pcap_file, "-Y", display_filter, "-w", filename]
    subprocess.run(command)
    count += 1
    # print(malware_dir)